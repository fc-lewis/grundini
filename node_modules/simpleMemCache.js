var urlParser = require('url');

var cache = {}, urlStr;
var expiresAfterMs = (1000 * 60 * 10); // ten mins

this.getKeyFromUrl = function(urlObj, ignores) {
  var copy = [urlObj].splice(0, 1)[0];//should create a copy of the url
  var key, qs = '?';

  for (key in copy.query) {
    if (ignores.indexOf(key) == -1) {
      qs = qs + key + '=' + copy.query[key] + '&';
    }
  }

  urlStr = copy.pathname + qs;
  return urlStr;
};

this.put = function(key, value) {
  cache[key] = { data : value,
    timestamp : new Date().getTime()};

  return cache[key].data;
};

this.get = function(key) {
  if (cache[key]) {
    if (new Date().getTime() - cache[key].timestamp < expiresAfterMs) {
      return cache[key].data;
    }

    delete cache[key];
  }

  return undefined;
};


setInterval(function() {
  for (var key in cache) {
    if (new Date().getTime() - cache[key].timestamp > expiresAfterMs) {
      delete cache[key];
    }
  }

}, expiresAfterMs + 1000);