<!DOCTYPE HTML>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <script src="./js/libs/jquery-1.10.0.min.js"></script>
    <script src="./js/libs/jquery.infinitescroll.min.js"></script>
    <script src="./js/libs/grundini-homepage-tags.js"></script>
    <script>

        $(document).ready(function(e){
            var contentHeight = 800;
            var pageHeight = document.documentElement.clientHeight;
            var index = 0,
                lastScrollPos = 0,
                reachedEnd = false;

            var tags = new window.Tags({
                url : 'js/test-data/tags.json',
                pageSize : 2,
                onReadyFn : function(_tags){
//                    console.log('tags ready');
//
//                    console.log(tags.getPage(1));
//                    console.log(tags.getPage(2));
//                    console.log(tags.getPage(3));
//                    console.log(tags.getPage(11));
                }
            });

            function getTagsHtml(tags){
                var i = 0, html = '';
                for(i; i < tags.length; i++){
                    html+='<li><span>'+tags[i].content+'</span></li>'
                }

                return html;
            }

            function getScrollDirection(thisScrollPos, lastScrollPos){
                return thisScrollPos > lastScrollPos ? 'down' : 'up';
            }

            $(document).on('scroll.addtags', function(e){
                //console.log('document.height = %s', document.height);
                var thisScrollPos = $(window).scrollTop(),
                    currentPage = [];

                if(getScrollDirection(thisScrollPos, lastScrollPos) === 'down'){
                    if((contentHeight - pageHeight - thisScrollPos) < pageHeight){
                        currentPage = tags.getPage(index);

                        if(!currentPage.length || currentPage.length === 0){
                            reachedEnd = true;
                            $('#tags>ul').append('<li><span>End of tags.</span></li>');

                            $(document).off('scroll.addtags');
                        }else{
                            $('#tags>ul').append(getTagsHtml(currentPage));
                            index+=1;
                        }
                        console.log(currentPage);
                    }
                }
            });
        });

    </script>
    <style>
        #tags > ul > li{
            font-family: Helvetica;
            background-color: black;
            color:white;
            display:block;
            float:left;
            height:150px;
            margin:5px;
            padding:5px;
            width:150px;
        }
    </style>
</head>
<body>

<div id="tags">
    <ul>

    </ul>
</div>

</body>
</html>